<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>שטח מת - אפליקציית החמ"ל 8211</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
    <style>
      body {
        background-color: black;
        color: white;
        font-family: helvetica;
        direction: rtl;
        font-size: 20px;
        transition: all 0.5s ease-out;
      }
      .container {
        display: flex;
        max-width: 900px;
        margin: auto;
        flex-direction: column;
      }
      input {
        padding: 10px;
        border-radius: 5px;
        border: 2px solid #555;
        flex: 1;
        font-size: 20px;
        margin-bottom: 20px;
      }
      #output {
        line-height: 2em
      }
    </style>
  </head>
  <body>
    <div class="container">
      <input id="searchInput" />
      <div id="output"/>
    </div>
    <script>
      const encryptedData = 'U2FsdGVkX189oTE3SRTZMiQB6NQ+eJmHSO38zpYv6lj+9Rx7g0iRX1ApnY/BCYuuGGhw1DdlBr1tBbYEaNOH92dXq9n4JnBaAmCB6G6mHoHU//FAWKVh9tXdnartzlbJn/70OGpcyNXmAKAFi6ObzbIVBS7UnTKYI1pZKjTVYX2AuoidhWp1os8BFct47V2GCNGUloStwWWZHo87dPLuHn7HluhyBZE2pD30DdGwE5ojGlKhlm2csGT5bS2eSksG+YCc5pyGJLlDViukK1ZxCH1G54aP7dLXdYBe5uI93hQgqpk0254G5QecGwU9Cewh7+Jym2dGaps0b5Nl3NEQBW0fnEUnSqVT5lw69ltoOimVykyW8JotO261I2pykXhwhVudlP/SOSdgofKu18gvq0f4rbyIdt8qqaZQ7Gjq9hu1RHanRx/3w4nQYPHjZvAyJrR0sfgCGF1q1a6pPSTWRPt2kq61zdpLCVTYDjV8mZz6k/aHGZUfe4vlpe29Mm3mFktL8LjWfT91XrBqpAx9/MV9Uqau12j065vx16Nrd+jRjZ51fSSLoBAM3bakTfi9L7oUE2ZtssLvjC+mOlk8hrIi6V1qM44mLs5CW5uDs6FpOMog437RVwi6yH23234/UnyU7MvrlniNxMQZeugeH0ubTxeH9qA57s7sp5uIJi36F3d0aVQgZyMr1zzeqn1J4Z7KMouQcA+iXt05mJtOEJlZB6xtZOgxXE3VRBDPCjur5I+HQ52mlosf+sesh8RcXT24HezWfZ/GmEDEP75vOZhtT+eDUzB8qdphXpKew4UGdnDnzMB4017OKAaRLX1GZjwA7/3+nc9NKhzBzXE3/uEmNyU/ee2qg1kbTOcVFQ4HtAU6JM7vz4S4K4cjcY4iYj3vkISaIi1TtUg2pWKDaiCAl8gVnICG4upCpT79ucwloIrl/jBd+tMXfpEB6Y8boS0JrQIwb4epYiQipDA0Fb29NCqt2qevBv4AWl2NXnoiyWHftMI4urK0vv5H080ZDodRP2rOvipXatv1Y8ZUE3Pv/KFQLzb7Ltp3B7613m3NW4IF1HQN6zHi70otMEF1Ael+NL8aWCXwYMELqZGJdHCFnpc99ZSGfVZZ4oP3KVmT5jjsuM7Kh6Z5QHHhmtNJ1b066vvspPGb+d68kt4fTW2C8Y1iDsmxlca5CswZ/peGMWZdcWTucP7qoCL9Mr5Olt5UT7sQdQusl0hN3mgPrkqeSkzXlLlpYWqKMjInoi7ddGZYoFhh+KKpGwPfDm5LTtA7gPuQAp7zUcxEHV5+AgQkRLphCRUwzbHbREXvGWpuE8VaHWIqQgFicOyKotreICMFhYTW3ypU43dRGfX2txt/u2YULnmvSk+tA/+LXQsQ1L+rfScscioAz+x5LIoP+8z/TeAPQHbkky2R9JCEj13wmaPTOL5rbutZmyO6RgKOcC4rjhjseK8A+frjub4XndK9r+8sF03Tdx0rAe70I8g7w5PyxVkZgoIitVEi39/ce+uiIwYS5LsqDJZH+5VIPshELYfngpuuXrdADmEdvNshOEgSA+VlEqg1wxYRxYnHYGtyYcS9QtMhwb8dTExxbrlXxNPGyAh1bgfVqYHVD3dAfa42kcshq2iVLcd6lI5sT3qRr6hkpRVOnDbFqEQesR1n+vH14byiMqC4YUhb6/FSJlDDqzwwD3udGqlB4siuLrRuLJLNxrgbm8mRYRW8WJ5qdw1nyLW24VqAQiK9ThqsBLnPv8vFjoXeK0Y5QUWHVl+i/2MDtYPGqj/fv8IFkzc/8XKSFGe/bu4TpoxGC6u8HO58UYm7GX2ncudqeF2reNmKEHxJYS73D54RbL4p';
      let decryptedData;

      function getFenceOwner(fencePoint) {
        const result = decryptedData.fenceOwners.find(
          fenceRegion =>
            fenceRegion.from <= fencePoint && fenceRegion.to >= fencePoint,
        );
        if (result) {
          return result.owner;
        } else {
          return 'מחוץ לגבולות';
        }
      }

      function getRegionDetails(fencePoint) {
        const result = decryptedData.fenceRegions.find(
          fenceRegion =>
            fenceRegion.from <= fencePoint && fenceRegion.to >= fencePoint,
        );

        if (result) {
          return result.type;
        } else {
          return 'שטח חי';
        }
      }

      function getTroubledRegion(fencePoint) {
        const result = decryptedData.troubledRegions.find(
          fenceRegion =>
            fenceRegion.from <= fencePoint && fenceRegion.to >= fencePoint,
        );

        if (result) {
          return result.type;
        } else {
          return 'שטח תקין';
        }
      }

      let state = 'login';

      const searchInput = document.querySelector('#searchInput');
      const output = document.querySelector('#output');

      searchInput.addEventListener('keyup', (e) => {
        const value = searchInput.value;
        if (state === 'login') {
          const data = CryptoJS.AES.decrypt(encryptedData, value);
          try {
            decryptedData = JSON.parse(data.toString(CryptoJS.enc.Utf8));
            state = 'search';
            render();
          } catch (err) {
            console.log(err)
          }
        } else {
          const fenceOwner = getFenceOwner(value);
          const regionDetails = getRegionDetails(value);
          const troubledRegion = getTroubledRegion(value);

          if (regionDetails === 'שטח מת') {
            regionDetailsColor = 'red'
          } else {
            regionDetailsColor = 'inherit'
          }

          if (troubledRegion === 'שטח בעייתי') {
            troubledRegionColor = 'red'
          } else {
            troubledRegionColor = 'inherit'
          }

          output.innerHTML = `
          קו דיווח ${value}:
          <br/>
          תצפית: <b>${fenceOwner}</b>
          <br/>
          מידע נוסף: <b style="background-color: ${regionDetailsColor}">${regionDetails}</b>,
          <b style="background-color: ${troubledRegionColor}"> ${troubledRegion}</b>
          `
        }
      });

      function render() {
        searchInput.value = '';
        if (state === 'login') {
          searchInput.placeholder = 'הזן סיסמא'
          searchInput.setAttribute('type', 'password')
          document.body.style.backgroundColor = 'black';
        } else if (state === 'search') {
          searchInput.placeholder = 'הזן קו דיווח/שם חייל'
          searchInput.setAttribute('type', 'text')
          document.body.style.backgroundColor = '#4caf50';
        }
      }

      render();
    </script>
  </body>
</html>
